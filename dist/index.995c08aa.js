const e=()=>{},t=e=>e.some((e=>e.some(((t,s)=>{if(0===s)return!1;if(t.isEmpty())return!1;return e[s-1].canAcceptTile(t.getTile())})))),s=(e,t)=>Math.floor(Math.random()*(t-e+1)+e);var i=class{#e=!1;#t=this.#s.bind(this);#i;subscribe(t=e){this.#i=t,window.addEventListener("keydown",this.#t)}unsubscribe(){window.removeEventListener("keydown",this.#t)}async#s(e){this.#e||(this.#e=!0,await this.#i(e.key),this.#e=!1)}};var r=class{#r;#l;#n;#o;#h=null;constructor(e,t,s=null){this.#r=e,this.#l=t,this.#o=s,this.#n=document.createElement("div"),this.#a()}getX(){return this.#r}getY(){return this.#l}getCoords(){return{x:this.#r,y:this.#l}}getTile(){return this.#o}getTileToMerge(){return this.#h}getElement(){return this.#n}setX(e){return this.#r=e,this.#n.style.setProperty("--x",e),this}setY(e){return this.#l=e,this.#n.style.setProperty("--y",e),this}setCoords(e,t){return this.setX(e),this.setY(t),this}setTile(e){return this.#o=e,null!==e&&(e.setX(this.getX()),e.setY(this.getY())),this}setTileToMerge(e){return this.#h=e,e.setCoords(this.#o.getX(),this.#o.getY()),e.getElement().style.setProperty("z-index","1"),this}isEmpty(){return!this.#o}hasTileToMerge(){return this.#h}canAcceptTile(e=null){return!e||!this.#o||this.#o.getValue()===e.getValue()&&!this.hasTileToMerge()}mergeTiles(){return this.hasTileToMerge()&&(this.#o.setValue(this.#h.getValue()+this.#o.getValue()),this.#h.remove(),this.#h=null),this}#a(){this.#n.classList.add("cell"),this.#n.style.setProperty("--x",this.#r),this.#n.style.setProperty("--y",this.#l)}};var l=class{#r;#l;#u;#c=document.createElement("div");constructor(e,t,s=null){this.#r=e,this.#l=t,this.#u=s,this.#a()}getX(){return this.#r}getY(){return this.#l}getCoords(){return{x:this.#r,y:this.#l}}getValue(){return this.#u}getElement(){return this.#c}setX(e){return this.#r=e,this.#c.style.setProperty("--x",e),this}setY(e){return this.#l=e,this.#c.style.setProperty("--y",e),this}setCoords(e,t){return this.setX(e),this.setY(t),this}setValue(e){return this.#u=e,this.#c.innerText=e,this}remove(){return this.#c.remove(),this}delayTransition(){return new Promise((e=>{this.#c.addEventListener("transitionend",e,{once:!0})}))}#a(){this.#c.classList.add("tile"),this.#c.style.setProperty("--x",this.#r),this.#c.style.setProperty("--y",this.#l),this.#c.innerText=this.#u}};var n=class{#d=new i;#y=[];#m=[];#g=[];#p;#T;constructor(e){this.#T=e,this.#p=4,this.#m=Array(4).fill(-1).map((()=>[])),this.#g=Array(4).fill(-1).map((()=>[])),this.#v(),this.#E(2),this.#d.subscribe(this.#w.bind(this))}async slideTilesLeft(){return this.#f(this.#g)}async slideTilesUp(){return this.#f(this.#m)}async slideTilesRight(){return this.#f(this.#g.map((e=>[...e].reverse())))}async slideTilesDown(){return this.#f(this.#m.map((e=>[...e].reverse())))}#v(){for(let e=0;e<this.#p*this.#p;e+=1){const t=Math.floor(e/this.#p),s=e%this.#p,i=new r(t,s);this.#g[t].push(i),this.#m[s].push(i),this.#y.push(i),this.#T.appendChild(i.getElement())}}#M(e=1){const t=this.#y.filter((e=>e.isEmpty()));if(1===e)return[t[s(0,t.length-1)]];const i=Math.floor(t.length/2);return[t[s(0,i)],t[s(i+1,t.length-1)]]}#E(e=1){this.#M(e).forEach((e=>{const t=new l(e.getX(),e.getY(),2**s(1,2));e.setTile(t),this.#T.appendChild(t.getElement())}))}async#f(e){const{dirtyCells:t,transitions:s}=(e=>{const t=[],s=[];return e.forEach((e=>{for(let i=1;i<e.length;i+=1){const r=e[i];let l=null;if(!r.isEmpty()){for(let t=i-1;t>=0;t-=1){const s=e[t];if(!s.canAcceptTile(r.getTile()))break;l=s}null!==l&&(l.isEmpty()?l.setTile(r.getTile()):(s.push(r.getTile().delayTransition()),l.setTileToMerge(r.getTile()),t.push(l)),r.setTile(null))}}})),{dirtyCells:t,transitions:s}})(e);return Promise.all(s).then((()=>{t.forEach((e=>e.mergeTiles())),this.#E()}))}async#w(e){if(this.#P())switch(e){case"ArrowLeft":if(this.#b())return this.slideTilesLeft();break;case"ArrowUp":if(this.#$())return this.slideTilesUp();break;case"ArrowRight":if(this.#x())return this.slideTilesRight();break;case"ArrowDown":if(this.#C())return this.slideTilesDown();break;default:return Promise.resolve()}else this.#d.unsubscribe();return Promise.resolve()}#P(){return this.#b()||this.#$()||this.#x()||this.#C()}#b(){return t(this.#g)}#$(){return t(this.#m)}#x(){return t(this.#g.map((e=>[...e].reverse())))}#C(){return t(this.#m.map((e=>[...e].reverse())))}};document.documentElement.style.setProperty("--main-background-color","#2E251A"),document.documentElement.style.setProperty("--game-board-background-color","#83786E"),document.documentElement.style.setProperty("--cell-background-color","#A99E94"),document.documentElement.style.setProperty("--grid-size","4"),document.documentElement.style.setProperty("--cell-size","20vmin"),document.documentElement.style.setProperty("--cell-gap","2vmin"),document.documentElement.style.setProperty("--default-font-family","'Quicksand', Helvetica Neue, Helvetica, Arial, sans"),document.documentElement.style.setProperty("--default-font-size","7.5vmin");new n(document.getElementById("game-board"));
//# sourceMappingURL=index.995c08aa.js.map
